<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <title>StartupStack-AI - AI-Powered SaaS Bundle for Entrepreneurs</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Enhanced Logo Animations */
        .logo-container:hover .fas.fa-brain {
            animation: brainPulse 2s ease-in-out infinite;
        }
        .logo-container:hover .fas.fa-rocket {
            animation: rocketBoost 1.5s ease-in-out infinite;
        }
        .logo-container:hover .animate-pulse {
            animation: neuralSync 1s ease-in-out infinite;
        }
        
        @keyframes brainPulse {
            0%, 100% { transform: scale(1); color: rgb(168 85 247); }
            50% { transform: scale(1.1); color: rgb(219 39 119); }
        }
        
        @keyframes rocketBoost {
            0%, 100% { transform: rotate(12deg) translateY(0); }
            50% { transform: rotate(12deg) translateY(-2px); }
        }
        
        @keyframes neuralSync {
            0%, 100% { opacity: 0.6; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }
    </style>
    <script src="https://assets.lemonsqueezy.com/lemon.js" defer></script>
    <script src="config.js"></script>
    <script src="monitoring.js"></script>
    <script type="module">
        import startupStackPromise from './app.js';
        
        // Initialize StartupStack and make it globally available
        async function initializeApp() {
            try {
                // Wait for StartupStack to initialize
                const stack = await startupStackPromise;
                window.StartupStack = stack;
                
                // Enable checkout buttons after initialization
                document.querySelectorAll('[data-checkout-button]').forEach(button => {
                    button.disabled = false;
                });
            } catch (error) {
                console.error('Failed to initialize StartupStack:', error);
                showNotification('Failed to initialize application', 'error');
            }
        }

        // Initialize immediately when script loads
        initializeApp();

        // Register service worker for production caching
        if ('serviceWorker' in navigator && window.APP_CONFIG?.environment === 'production') {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('SW registered: ', registration);
                    })
                    .catch((registrationError) => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }

        // Make startCheckout available globally
        window.startCheckout = async function(event) {
            event.preventDefault();
            const currentButton = event.currentTarget;
            const originalText = currentButton.innerHTML;
            
            try {
                currentButton.disabled = true;
                currentButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';

                // Initialize StartupStack if needed
                if (!window.StartupStack?.initialized) {
                    await initializeApp();
                }

                // Store the selected variant ID
                const variantId = currentButton.dataset.variantId;
                if (!variantId) {
                    throw new Error('Invalid variant selected');
                }
                localStorage.setItem('selectedVariantId', variantId);                // Always open in signup mode for checkout
                window.openAuthModal('signup');

            } catch (error) {
                console.error('Checkout error:', error);
                showNotification(error.message || 'Something went wrong', 'error');
            } finally {
                if (currentButton) {
                    currentButton.disabled = false;
                    currentButton.innerHTML = originalText;
                }
            }
        };

        // New function for free trial signup
        window.startFreeTrial = async function(event) {
            event.preventDefault();
            const currentButton = event.currentTarget;
            const originalText = currentButton.innerHTML;
            
            try {
                currentButton.disabled = true;
                currentButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Starting Trial...';

                // Initialize StartupStack if needed
                if (!window.StartupStack?.initialized) {
                    await initializeApp();
                }

                // Clear any previous variant selection since this is free trial
                localStorage.removeItem('selectedVariantId');
                localStorage.setItem('isFreeTrial', 'true');

                // Always open in signup mode for free trial
                window.openAuthModal('signup');

            } catch (error) {
                console.error('Free trial error:', error);
                showNotification(error.message || 'Something went wrong', 'error');
            } finally {
                if (currentButton) {
                    currentButton.disabled = false;
                    currentButton.innerHTML = originalText;
                }
            }
        };

        async function initializeAITools(userId) {
            try {
                const { aiTools, userManager } = window.StartupStack;

                // Test each AI tool with sample data
                const tools = [
                    {
                        name: 'businessNameGenerator',
                        func: () => aiTools.generateBusinessNames('technology', 'innovative, modern'),
                    },
                    {
                        name: 'contentCalendar',
                        func: () => aiTools.generateContentCalendar('tech startup', 'entrepreneurs'),
                    },
                    {
                        name: 'emailTemplates',
                        func: () => aiTools.generateEmailTemplates('welcome series', 'technology'),
                    },
                    {
                        name: 'marketResearch',
                        func: () => aiTools.analyzeMarket('SaaS', 'global'),
                    }
                ];

                // Initialize each tool
                for (const tool of tools) {
                    try {
                        const result = await tool.func();
                        // Tool usage tracking removed
                    } catch (error) {
                        console.error(`Error initializing ${tool.name}:`, error);
                    }
                }
            } catch (error) {
                console.error('Tool initialization error:', error);
                throw new Error('Failed to initialize AI tools');
            }
        }

        async function handleSuccessfulPayment(subscriptionId) {
            try {
                const email = localStorage.getItem('userEmail');
                if (!email) throw new Error('User email not found');

                // Initialize StartupStack
                const { aiTools, userManager } = window.StartupStack;

                // Register user in Supabase
                const user = await userManager.signUp(email);
                if (!user) throw new Error('Failed to register user');

                // Store user data in localStorage
                localStorage.setItem('userId', user.id);
                localStorage.setItem('subscriptionId', subscriptionId);
                
                // Initialize AI tools
                await initializeAITools(user.id);

                showNotification('Payment successful! Welcome to StartupStack-AI!', 'success');
                
                // Redirect to dashboard after short delay
                setTimeout(() => {
                    window.location.href = '/dashboard.html';
                }, 2000);
            } catch (error) {
                console.error('Post-payment setup error:', error);
                showNotification('Account setup error: ' + error.message, 'error');
            }
        }

        // Update the payment success handler        // Note: This function is now deprecated in favor of handleLemonSqueezySuccess
        async function handlePaymentSuccess() {
            const urlParams = new URLSearchParams(window.location.search);
            const checkoutId = urlParams.get('checkout_id');
            
            // Redirect to handleLemonSqueezySuccess to avoid duplicate handling
            if (checkoutId) {
                handleLemonSqueezySuccess();
            }
        }// Handle LemonSqueezy success redirect
        async function handleLemonSqueezySuccess() {
            const urlParams = new URLSearchParams(window.location.search);
            const checkoutId = urlParams.get('checkout_id');

            if (checkoutId) {
                try {
                    const stack = await startupStackPromise;
                    const userId = localStorage.getItem('userId');
                    
                    if (!userId) {
                        throw new Error('No user session found');
                    }

                    // Get user's current plan type
                    const { data: userData, error: userError } = await stack.supabase
                        .from('users')
                        .select('plan_type, lemonsqueezy_checkout_id')
                        .eq('id', userId)
                        .single();

                    if (userError) throw userError;

                    // Update subscription status based on plan type
                    const { error } = await stack.supabase
                        .from('users')
                        .update({ 
                            subscription_status: userData.plan_type === 'annual' ? 'annual_active' : 'active',
                            lemonsqueezy_checkout_id: checkoutId,
                            activated_at: new Date().toISOString()
                        })
                        .eq('id', userId);                    if (error) throw error;

                    // Show success message and redirect once
                    showNotification('Subscription activated successfully!', 'success');
                    window.location.href = '/dashboard.html';

                } catch (error) {
                    console.error('Payment success handling error:', error);
                    showNotification('Error activating subscription', 'error');
                    window.location.href = '/?subscription=error';
                }
            }
        }

        // Check for success redirect on page load
        // Only handle if we're not already on the success page
        if (window.location.search.includes('checkout_id') && !window.location.pathname.includes('success.html')) {
            handleLemonSqueezySuccess();
        }
    </script>
</head>
<body class="bg-gray-900 text-white">
    <!-- Hero Section -->
    <div class="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900">        <nav class="p-6">
            <div class="max-w-6xl mx-auto flex justify-between items-center">
                <div class="text-2xl font-bold flex items-center logo-container">
                    <div class="relative mr-3">
                        <!-- Neural network nodes -->
                        <div class="flex items-center space-x-1">
                            <div class="w-2 h-2 bg-gradient-to-r from-purple-400 to-pink-400 rounded-full animate-pulse"></div>
                            <div class="w-1 h-1 bg-purple-300 rounded-full"></div>
                            <div class="w-2 h-2 bg-gradient-to-r from-blue-400 to-purple-400 rounded-full animate-pulse" style="animation-delay: 0.3s"></div>
                        </div>
                        <!-- Connection lines -->
                        <div class="absolute top-1 left-0 w-full h-px bg-gradient-to-r from-purple-400 to-blue-400 opacity-50"></div>
                        <!-- AI Brain icon -->
                        <i class="fas fa-brain text-lg text-purple-400 absolute -top-1 -left-1 opacity-80"></i>
                        <!-- Startup rocket -->
                        <i class="fas fa-rocket text-sm text-pink-400 absolute -top-2 -right-1 transform rotate-12"></i>
                    </div>
                    <span class="bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">StartupStack</span>
                    <span class="text-xs text-purple-300 ml-1 font-normal">AI</span>
                </div>                <div class="flex items-center space-x-4">
                    <button onclick="window.openAuthModal('login')" class="border border-purple-400 text-purple-200 px-6 py-2 rounded-lg hover:bg-purple-900 hover:border-purple-300 hover:text-white transition-all duration-300 flex items-center">
                        <i class="fas fa-user mr-2"></i>Login
                    </button>
                    <button onclick="scrollToPrice()" class="bg-purple-600 px-6 py-2 rounded-lg hover:bg-purple-700 transition duration-200 shadow-lg hover:shadow-purple-500/30">Sign Up</button>
                </div>
            </div>
        </nav>
        
        <div class="max-w-6xl mx-auto px-6 py-20 text-center">
            <h1 class="text-5xl md:text-7xl font-bold mb-6 bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">
                8 AI-Powered Tools<br>One Startup Bundle
            </h1>            <p class="text-xl md:text-2xl mb-8 text-gray-300 max-w-3xl mx-auto">
                Everything you need to launch your startup: Business names, logos, pitch decks, market research, content planning, and more. All powered by AI.
            </p>
            
            <button onclick="scrollToPrice()" class="bg-gradient-to-r from-purple-600 to-pink-600 text-white px-8 py-4 rounded-lg text-xl font-semibold hover:scale-105 transform transition">
                Sign Up & Start Your Startup Journey
            </button>
        </div>
    </div>

    <!-- Tools Section -->
    <section class="py-20 bg-gray-800">
        <div class="max-w-6xl mx-auto px-6">
            <h2 class="text-4xl font-bold text-center mb-16">Your Complete Startup Toolkit</h2>
            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-8">
                <div class="bg-gray-700 p-6 rounded-lg">
                    <i class="fas fa-lightbulb text-3xl text-purple-400 mb-4"></i>
                    <h3 class="text-xl font-semibold mb-2">Business Name Generator</h3>
                    <p class="text-gray-300">AI generates brandable names with domain availability check</p>
                </div>
                <div class="bg-gray-700 p-6 rounded-lg">
                    <i class="fas fa-palette text-3xl text-blue-400 mb-4"></i>
                    <h3 class="text-xl font-semibold mb-2">Logo Creator</h3>
                    <p class="text-gray-300">Professional logos in seconds with unlimited variations</p>
                </div>
                <div class="bg-gray-700 p-6 rounded-lg">
                    <i class="fas fa-chart-line text-3xl text-green-400 mb-4"></i>
                    <h3 class="text-xl font-semibold mb-2">Pitch Deck Templates</h3>
                    <p class="text-gray-300">50+ investor-ready templates with AI customization</p>
                </div>
                <div class="bg-gray-700 p-6 rounded-lg">
                    <i class="fas fa-search text-3xl text-yellow-400 mb-4"></i>
                    <h3 class="text-xl font-semibold mb-2">Market Research Tool</h3>
                    <p class="text-gray-300">AI analyzes competitors and market opportunities</p>
                </div>
                <div class="bg-gray-700 p-6 rounded-lg">
                    <i class="fas fa-calendar text-3xl text-red-400 mb-4"></i>
                    <h3 class="text-xl font-semibold mb-2">Content Planner</h3>
                    <p class="text-gray-300">30-day social media calendars generated by AI</p>
                </div>
                <div class="bg-gray-700 p-6 rounded-lg">
                    <i class="fas fa-envelope text-3xl text-indigo-400 mb-4"></i>
                    <h3 class="text-xl font-semibold mb-2">Email Templates</h3>
                    <p class="text-gray-300">100+ proven email sequences for every situation</p>
                </div>
                <div class="bg-gray-700 p-6 rounded-lg">
                    <i class="fas fa-file-contract text-3xl text-pink-400 mb-4"></i>
                    <h3 class="text-xl font-semibold mb-2">Legal Documents</h3>
                    <p class="text-gray-300">AI-generated contracts, terms, and privacy policies</p>
                </div>
                <div class="bg-gray-700 p-6 rounded-lg">
                    <i class="fas fa-calculator text-3xl text-teal-400 mb-4"></i>
                    <h3 class="text-xl font-semibold mb-2">Financial Projections</h3>
                    <p class="text-gray-300">AI-powered revenue modeling and forecasting</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Pricing Section -->
    <section id="pricing" class="py-20 bg-gray-900">
        <div class="max-w-4xl mx-auto px-6">
            <h2 class="text-4xl font-bold text-center mb-16">Simple, Transparent Pricing</h2>
            <div class="grid md:grid-cols-3 gap-8">
                <!-- Starter -->
                <div class="bg-gray-800 p-8 rounded-lg">
                    <h3 class="text-2xl font-bold mb-4">Starter</h3>
                    <div class="text-4xl font-bold mb-6">$29<span class="text-lg text-gray-400">/month</span></div>
                    <ul class="space-y-3 mb-8 text-gray-300">
                        <li><i class="fas fa-check text-green-400 mr-2"></i>3 Core Tools</li>
                        <li><i class="fas fa-check text-green-400 mr-2"></i>Basic Templates</li>
                        <li><i class="fas fa-check text-green-400 mr-2"></i>Email Support</li>
                    </ul>
                    <button 
                        onclick="startCheckout(event)"
                        data-checkout-button
                        data-variant-id="880115"
                        disabled
                        class="w-full bg-gray-700 text-white py-3 rounded-lg hover:bg-gray-600 transition duration-200 font-semibold flex items-center justify-center">
                        <i class="fas fa-credit-card mr-2"></i>Choose Starter
                    </button>
                </div>
                
                <!-- Pro (Featured) -->
                <div class="bg-gradient-to-b from-purple-600 to-pink-600 p-8 rounded-lg relative">
                    <div class="absolute -top-4 left-1/2 transform -translate-x-1/2 bg-yellow-400 text-gray-900 px-4 py-1 rounded-full text-sm font-semibold">MOST POPULAR</div>
                    <h3 class="text-2xl font-bold mb-4">Pro Bundle</h3>
                    <div class="text-4xl font-bold mb-6">$79<span class="text-lg text-gray-300">/month</span></div>
                    <ul class="space-y-3 mb-8 text-gray-100">
                        <li><i class="fas fa-check text-yellow-400 mr-2"></i>All 8 Tools</li>
                        <li><i class="fas fa-check text-yellow-400 mr-2"></i>Premium Templates</li>
                        <li><i class="fas fa-check text-yellow-400 mr-2"></i>Priority Support</li>
                        <li><i class="fas fa-check text-yellow-400 mr-2"></i>Advanced Features</li>
                    </ul>
                    <button 
                        onclick="startCheckout(event)" 
                        data-checkout-button
                        data-variant-id="880114"
                        disabled
                        class="w-full bg-white text-purple-600 py-3 rounded-lg font-semibold hover:bg-gray-100 transition duration-200 flex items-center justify-center">
                        <i class="fas fa-credit-card mr-2"></i>Subscribe Now
                    </button>
                </div>
                
                <!-- Annual Pro Plan -->
                <div class="bg-gray-800 p-8 rounded-lg">
                    <h3 class="text-2xl font-bold mb-4">Annual Pro Plan</h3>
                    <div class="text-4xl font-bold mb-6">$468<span class="text-lg text-gray-400">/year</span></div>
                    <ul class="space-y-3 mb-8 text-gray-300">
                        <li><i class="fas fa-check text-green-400 mr-2"></i>Everything in Pro</li>
                        <li><i class="fas fa-check text-green-400 mr-2"></i>2 Months Free</li>
                        <li><i class="fas fa-check text-green-400 mr-2"></i>Priority Support</li>
                        <li><i class="fas fa-check text-green-400 mr-2"></i>Advanced Features</li>
                    </ul>
                    <button 
                        onclick="startCheckout(event)"
                        data-checkout-button
                        data-variant-id="880113"
                        disabled
                        class="w-full bg-gradient-to-r from-green-600 to-blue-600 text-white py-3 rounded-lg hover:opacity-90 transition duration-200 font-semibold flex items-center justify-center">
                        <i class="fas fa-credit-card mr-2"></i>Get Annual Plan
                    </button>
                </div>            </div>
            
            <!-- Already a member section - COMMENTED OUT TEMPORARILY
            <div class="mt-16 text-center">
                <div class="inline-block bg-gray-800 px-8 py-6 rounded-lg shadow-lg border border-gray-700">
                    <p class="text-lg text-gray-300 mb-4">Already a member?</p>
                    <button onclick="window.openAuthModal('login')" class="bg-transparent border-2 border-purple-400 text-purple-300 px-8 py-3 rounded-lg hover:bg-purple-900 hover:text-white transition-all duration-200 flex items-center mx-auto">
                        <i class="fas fa-sign-in-alt mr-3"></i>
                        <span class="font-medium">Login to your account</span>
                    </button>
                </div>
            </div>
            -->
        </div>
    </section>

    <!-- CTA Section -->
    <section class="py-20 bg-gradient-to-r from-purple-600 to-pink-600">
        <div class="max-w-4xl mx-auto px-6 text-center">
            <h2 class="text-4xl font-bold mb-6">Ready to Launch Your Startup?</h2>
            <button 
                onclick="startFreeTrial(event)" 
                class="bg-white text-purple-600 px-8 py-4 rounded-lg text-xl font-semibold hover:bg-gray-100">
                <i class="fas fa-play mr-2"></i>Start Your Free Trial Today
            </button>
        </div>
    </section>    <!-- Auth Modal -->
<div id="authModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
    <div class="bg-gray-800 p-8 rounded-lg max-w-md w-full mx-4 shadow-xl">
        <!-- Modal Header -->
        <div class="flex justify-between items-center mb-6">
            <h2 id="authTitle" class="text-2xl font-bold text-white">Log In</h2>
            <button onclick="closeAuthModal()" class="text-gray-400 hover:text-white">
                <i class="fas fa-times"></i>
            </button>
        </div>        <!-- Auth Tabs - showing single tab at a time -->
        <div class="flex mb-6 border-b border-gray-700" id="authTabs">
            <div id="loginTab" style="width: 100%;" class="py-3 text-center">
                <h3 class="font-medium text-white border-b-2 border-purple-500 inline-flex items-center">
                    <i class="fas fa-sign-in-alt mr-2"></i>Log In
                </h3>
            </div>
            <div id="signupTab" style="display: none; width: 100%;" class="py-3 text-center">
                <h3 class="font-medium text-white border-b-2 border-purple-500 inline-flex items-center">
                    <i class="fas fa-user-plus mr-2"></i>Sign Up
                </h3>
            </div>
        </div>
          <!-- Tab switching logic moved to global scope -->

        <!-- Auth Form -->
        <form id="authForm" class="space-y-4">
            <div>
                <label for="email" class="block text-sm font-medium mb-2 text-white">Email Address</label>
                <input type="email" id="email" name="email" required
                    class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-purple-500">
            </div>

            <div id="nameField" class="hidden">
                <label for="userName" class="block text-sm font-medium mb-2 text-white">Your Name</label>
                <input type="text" id="userName" name="userName" 
                    class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-purple-500">
            </div>

            <div>
                <label for="password" class="block text-sm font-medium mb-2 text-white">Password</label>
                <input type="password" id="password" name="password" required minlength="8"
                    class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-purple-500">
                <div id="passwordHelper" class="mt-1 text-xs text-gray-400" style="display: none;">
                    Password must be at least 8 characters long
                </div>
            </div>

            <button type="submit" id="authSubmitBtn" 
                class="w-full bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 transition duration-300 shadow-lg hover:shadow-purple-500/30 font-medium flex items-center justify-center">
                <i id="loginBtnIcon" class="fas fa-sign-in-alt mr-2"></i>
                <span id="loginBtnText">Log In</span>
            </button>              <div id="authHelperText" class="mt-3 text-center text-sm text-gray-400">                <span id="loginHelper">New user? <a href="#" onclick="window.switchTab('signup'); return false;" class="text-purple-400 hover:underline">Create an account</a> to get started</span>
                <span id="signupHelper" style="display: none;">Already have an account? <a href="#" onclick="window.switchTab('login'); return false;" class="text-purple-400 hover:underline">Log in</a> instead</span>
            </div>
            
            <p class="text-center text-sm text-gray-400 mt-4">
                By continuing, you agree to our <a href="terms.html" class="text-purple-400 hover:underline">Terms of Service</a> and <a href="privacy.html" class="text-purple-400 hover:underline">Privacy Policy</a>
            </p>
        </form>
    </div>
</div>

    <script>        
        // Simple password hashing function using Web Crypto API
        async function hashPassword(password) {
            const encoder = new TextEncoder();
            const data = encoder.encode(password);
            const hash = await crypto.subtle.digest('SHA-256', data);
            return Array.from(new Uint8Array(hash))
                .map(b => b.toString(16).padStart(2, '0'))
                .join('');
        }

        function scrollToPrice() {
            document.getElementById('pricing').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Email Functions with improved error handling
        async function sendWelcomeEmail(userEmail, userName = 'New User') {
            try {
                const response = await fetch('/.netlify/functions/send-welcome-email', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: userEmail,
                        userName: userName
                    })
                });

                if (!response.ok) {
                    throw new Error('Failed to send welcome email');
                }

                showNotification('Welcome email sent! Check your inbox.', 'success');
                return true;
            } catch (error) {
                console.error('Failed to send welcome email:', error);
                showNotification('Welcome email will be sent shortly.', 'info');
                return false;
            }
        }        async function sendTrialEndingEmail(userEmail, userName = 'Valued Customer') {
            try {
                const response = await fetch('/.netlify/functions/send-trial-ending-email', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: userEmail,
                        userName: userName
                    })
                });

                if (!response.ok) {
                    throw new Error('Failed to send trial ending email');
                }

                showNotification('Trial ending reminder sent', 'success');
                return true;
            } catch (error) {
                console.error('Failed to send trial ending email:', error);
                showNotification('Failed to send trial ending reminder', 'error');
                return false;
            }
        }

        // Global notification function with improved styling and animation
        window.showNotification = function(message, type = 'info') {
            const notification = document.createElement('div');
            
            // Set styles based on notification type
            let bgColor, iconClass;
            switch(type) {
                case 'success':
                    bgColor = 'bg-green-600';
                    iconClass = 'fa-check-circle';
                    break;
                case 'error':
                    bgColor = 'bg-red-600';
                    iconClass = 'fa-exclamation-circle';
                    break;
                case 'warning':
                    bgColor = 'bg-yellow-500';
                    iconClass = 'fa-exclamation-triangle';
                    break;
                case 'info':
                default:
                    bgColor = 'bg-blue-600';
                    iconClass = 'fa-info-circle';
            }
            
            notification.className = `fixed top-4 right-4 ${bgColor} text-white py-3 px-5 rounded-md shadow-lg flex items-center space-x-3 z-50 transform transition-all duration-300 ease-out`;
            notification.style.maxWidth = '90%';
            
            // Add icon and message
            notification.innerHTML = `
                <i class="fas ${iconClass} text-lg"></i>
                <span>${message}</span>
            `;
            
            // Add to DOM
            document.body.appendChild(notification);
            
            // Animation
            setTimeout(() => {
                notification.style.transform = 'translateX(20px)';
                notification.style.opacity = '0';
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 3000);
        };

    // Define these variables and functions in the global scope so they're accessible everywhere
    let isLoginMode = true;
      // Simplified tab switching function that only shows one tab at a time
    window.switchTab = function(mode) {
        // Make sure auth modal is visible first
        const authModal = document.getElementById('authModal');
        if (authModal && authModal.classList.contains('hidden')) {
            authModal.classList.remove('hidden');
        }
        
        isLoginMode = mode === 'login';
        
        // Safely update DOM elements with error handling
        function safeUpdateElement(id, updateFn) {
            const element = document.getElementById(id);
            if (element) {
                updateFn(element);
            } else {
                console.warn(`Element #${id} not found in switchTab`);
            }
        }
        
        // Show only the active tab, hide the inactive one
        safeUpdateElement('loginTab', el => el.style.display = isLoginMode ? 'block' : 'none');
        safeUpdateElement('signupTab', el => el.style.display = !isLoginMode ? 'block' : 'none');
        
        // Update form elements
        const isFreeTrial = localStorage.getItem('isFreeTrial') === 'true';
        const titleText = isLoginMode ? 'Log In' : (isFreeTrial ? 'Start Your Free Trial' : 'Sign Up');
        
        safeUpdateElement('authTitle', el => el.textContent = titleText);
        safeUpdateElement('loginBtnText', el => el.textContent = isLoginMode ? 'Log In' : 'Create Account');
        safeUpdateElement('nameField', el => el.style.display = isLoginMode ? 'none' : 'block');
        safeUpdateElement('passwordHelper', el => el.style.display = !isLoginMode ? 'block' : 'none');
        
        // Update helper text visibility
        safeUpdateElement('loginHelper', el => el.style.display = isLoginMode ? 'inline' : 'none');
        safeUpdateElement('signupHelper', el => el.style.display = !isLoginMode ? 'inline' : 'none');
        
        // Update button styling based on mode
        safeUpdateElement('authSubmitBtn', submitBtn => {
            if (isLoginMode) {
                submitBtn.classList.remove('bg-green-600', 'hover:bg-green-700', 'hover:shadow-green-500/30');
                submitBtn.classList.add('bg-purple-600', 'hover:bg-purple-700', 'hover:shadow-purple-500/30');
            } else {
                submitBtn.classList.remove('bg-purple-600', 'hover:bg-purple-700', 'hover:shadow-purple-500/30');
                submitBtn.classList.add('bg-green-600', 'hover:bg-green-700', 'hover:shadow-green-500/30');
            }
        });
    }
      // Define openAuthModal function in the global scope
    window.openAuthModal = function(mode = 'login') {
        // Get the modal safely
        const authModal = document.getElementById('authModal');
        if (!authModal) {
            console.error('Auth modal not found in the DOM');
            return;
        }
        
        authModal.classList.remove('hidden');
        
        // Set mode explicitly based on parameter with timeout to ensure DOM is ready
        setTimeout(() => {
            try {
                window.switchTab(mode);
            } catch (e) {
                console.error('Error switching tab:', e);
            }
        }, 10);
    }
    
    // Define closeAuthModal in the global scope
    window.closeAuthModal = function() {
        const authModal = document.getElementById('authModal');
        if (authModal) {
            authModal.classList.add('hidden');
        }
        
        // Clear form fields safely
        const emailField = document.getElementById('email');
        const nameField = document.getElementById('userName');
        
        if (emailField) emailField.value = '';
        if (nameField) nameField.value = '';
    }
    
    // Show auth modal immediately if auth is required
    document.addEventListener('DOMContentLoaded', () => {
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.has('auth') || urlParams.has('subscription')) {
            // Determine which mode to open based on URL parameters
            const mode = urlParams.has('auth') && urlParams.get('auth') === 'signup' ? 'signup' : 'login';
            window.openAuthModal(mode);
        }
        
        // Handle upgrade parameter - scroll to pricing section
        if (urlParams.has('upgrade')) {
            setTimeout(() => {
                scrollToPrice();
                showNotification('Choose a plan to upgrade your account', 'info');
            }, 500);
        }
    });
    
    // Using the globally defined showNotification function
    const showNotification = window.showNotification;

    // Error messages
    const ERROR_MESSAGES = {
        USER_NOT_FOUND: 'User not found. Please sign up.',
        EMAIL_EXISTS: 'Email already exists. Please log in.',
        CHECKOUT_FAILED: 'Failed to start checkout process. Please try again.',
        CREATE_USER_FAILED: 'Failed to create account. Please try again.',
        INVALID_RESPONSE: 'Invalid server response. Please try again.',
        NAME_REQUIRED: 'Please enter your name to sign up.'
    };        // Ensure createLemonSqueezyCheckout is available globally
        window.createLemonSqueezyCheckout = async function createLemonSqueezyCheckout(email, userId) {
            try {
                const variantId = localStorage.getItem('selectedVariantId') || '880114';
                
                const response = await fetch('/.netlify/functions/create-lemonsqueezy-checkout', {
                method: 'POST',
                headers: { 
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                },
                body: JSON.stringify({ 
                    customerEmail: email, 
                    userId,
                    variantId: variantId
                })
            });
            
            if (!response.ok) {
                const errorText = await response.text();
                throw new Error(`HTTP ${response.status}: ${errorText}`);
            }

            const data = await response.json();
            
            if (!data || !data.checkout_url) {
                throw new Error('Invalid response: missing checkout URL');
            }

            return data;
        } catch (error) {
            console.error('Checkout function error:', error);
            throw error;
        }
    };    // Add event listener to the auth form on DOMContentLoaded to ensure DOM is ready
    document.addEventListener('DOMContentLoaded', () => {
        const authForm = document.getElementById('authForm');
        if (!authForm) {
            console.error('Auth form not found in the DOM');
            return;
        }
        
        authForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            
            const emailElement = document.getElementById('email');
            const userNameElement = document.getElementById('userName');
            const passwordElement = document.getElementById('password');
            
            if (!emailElement || !passwordElement) {
                console.error('Required form elements not found');
                return;
            }
            
            const email = emailElement.value;
            const userName = userNameElement ? userNameElement.value : null;
            const password = passwordElement.value;
            const submitButton = event.submitter;
            
            // Basic validation
            if (!password || password.length < 8) {
                showNotification('Password must be at least 8 characters long', 'warning');
                passwordElement.focus();
                return;
            }
            
            if (!isLoginMode && !userName) {
                showNotification(ERROR_MESSAGES.NAME_REQUIRED, 'warning');
                if (document.getElementById('userName')) {
                    document.getElementById('userName').focus();
                }
                return;
            }
            
            try {
                submitButton.disabled = true;
                submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
    
                // Initialize StartupStack if needed
                if (!window.StartupStack?.initialized) {
                    await initializeApp();
                }
    
                if (isLoginMode) {
                    // LOGIN FLOW
                    const { data: user, error: loginError } = await window.StartupStack.supabase
                        .from('users')
                        .select('*')
                        .eq('email', email)
                        .maybeSingle(); // Use maybeSingle instead of single to avoid errors when no results
                    
                    if (loginError || !user) {
                        console.error('Login error:', loginError || 'User not found');
                        // Suggest signing up instead
                        try {
                            window.switchTab('signup');
                            showNotification('Email not found. Please sign up instead.', 'info');
                        } catch (e) {
                            console.error('Error switching to signup tab:', e);
                            showNotification('Email not found. Please sign up instead.', 'info');
                        }
                        return;
                    }
                    
                    // Verify password
                    const passwordHash = await hashPassword(password);
                    if (user.password_hash && user.password_hash !== passwordHash) {
                        showNotification('Invalid email or password', 'error');
                        return;
                    }
                    
                    // If user doesn't have a password hash (old user), update it
                    if (!user.password_hash) {
                        const { error: updateError } = await window.StartupStack.supabase
                            .from('users')
                            .update({ 
                                password_hash: passwordHash,
                                last_login: new Date().toISOString()
                            })
                            .eq('id', user.id);
                        
                        if (updateError) {
                            console.error('Error updating password:', updateError);
                        }
                    } else {
                        // Update last login
                        const { error: updateError } = await window.StartupStack.supabase
                            .from('users')
                            .update({ last_login: new Date().toISOString() })
                            .eq('id', user.id);
                        
                        if (updateError) {
                            console.error('Error updating last login:', updateError);
                        }
                    }
    
                    // Store user data
                    localStorage.setItem('userId', user.id);
                    localStorage.setItem('userEmail', email);
                    if (user.name) {
                        localStorage.setItem('userName', user.name);
                    }
    
                    // Check subscription status
                    if (user.subscription_status === 'active') {
                        showNotification('Welcome back!', 'success');
                        window.location.replace('/dashboard.html');
                        return;
                    }

                    // Handle free trial users
                    if (user.subscription_status === 'free_trial') {
                        // Check if trial was created today (same UTC day)
                        const userCreatedDate = new Date(user.created_at);
                        const today = new Date();
                        
                        const userCreatedUTC = userCreatedDate.toISOString().split('T')[0];
                        const todayUTC = today.toISOString().split('T')[0];
                        
                        if (userCreatedUTC === todayUTC) {
                            // Same day - redirect to dashboard
                            showNotification('Welcome back to your free trial!', 'success');
                            window.location.replace('/dashboard.html');
                            return;
                        } else {
                            // Different day - trial expired, redirect to pricing
                            showNotification('Your free trial has ended. Please choose a subscription plan.', 'info');
                            closeAuthModal();
                            // Scroll to pricing section on current page
                            document.getElementById('pricing').scrollIntoView({ behavior: 'smooth' });
                            return;
                        }
                    }
    
                    // If subscription is pending or has an issue, redirect to checkout
                    showNotification('Please complete your subscription to continue', 'info');
                    
                    // Create checkout session with better error handling
                    try {
                        // Ensure we have a variant ID set
                        const currentVariantId = localStorage.getItem('selectedVariantId');
                        if (!currentVariantId) {
                            localStorage.setItem('selectedVariantId', '880114'); // Default to Pro plan
                        }
                        
                        // Use the same inline approach for login flow
                        const variantId = localStorage.getItem('selectedVariantId') || '880114';
                        
                        const response = await fetch('/.netlify/functions/create-lemonsqueezy-checkout', {
                            method: 'POST',
                            headers: { 
                                'Content-Type': 'application/json',
                                'Accept': 'application/json'
                            },
                            body: JSON.stringify({ 
                                customerEmail: email, 
                                userId: user.id,
                                variantId: variantId
                            })
                        });
                        
                        if (!response.ok) {
                            const errorText = await response.text();
                            throw new Error(`HTTP ${response.status}: ${errorText}`);
                        }
                        
                        const checkoutData = await response.json();
                        
                        if (!checkoutData || !checkoutData.checkout_url) {
                            throw new Error('Invalid checkout response received');
                        }
                        
                        window.location.href = checkoutData.checkout_url;
                    } catch (checkoutError) {
                        console.error('Checkout error:', checkoutError);
                        throw new Error('Failed to start checkout process. Please try again.');
                    }
                } else {
                    // SIGNUP FLOW
                    // Check if user already exists
                    const { data: existingUser } = await window.StartupStack.supabase
                        .from('users')
                        .select('id, email, subscription_status, created_at')
                        .eq('email', email)
                        .maybeSingle();
                    
                    if (existingUser) {
                        // Check if it's a free trial user trying to upgrade
                        const isFreeTrial = localStorage.getItem('isFreeTrial') === 'true';
                        
                        if (existingUser.subscription_status === 'free_trial' && !isFreeTrial) {
                            // Existing free trial user wants to upgrade - proceed with checkout
                            console.log('Free trial user upgrading to paid plan');
                            
                            // Store user data for checkout
                            localStorage.setItem('userId', existingUser.id);
                            localStorage.setItem('userEmail', email);
                            
                            // Create checkout session
                            const variantId = localStorage.getItem('selectedVariantId') || '880114';
                            
                            const response = await fetch('/.netlify/functions/create-lemonsqueezy-checkout', {
                                method: 'POST',
                                headers: { 
                                    'Content-Type': 'application/json',
                                    'Accept': 'application/json'
                                },
                                body: JSON.stringify({ 
                                    customerEmail: email, 
                                    userId: existingUser.id,
                                    variantId: variantId
                                })
                            });
                            
                            if (!response.ok) {
                                const errorText = await response.text();
                                throw new Error(`HTTP ${response.status}: ${errorText}`);
                            }
                            
                            const checkoutData = await response.json();
                            
                            if (!checkoutData || !checkoutData.checkout_url) {
                                throw new Error('Invalid checkout response received');
                            }
                            
                            window.location.href = checkoutData.checkout_url;
                            return;
                        } else {
                            // Regular case - switch to login mode
                            try {
                                window.switchTab('login');
                                showNotification('Email already exists. Please log in instead.', 'info');
                            } catch (e) {
                                console.error('Error switching to login tab:', e);
                                showNotification('Email already exists. Please log in instead.', 'info');
                            }
                            return;
                        }
                    }
                    
                    // Hash the password before storing
                    const passwordHash = await hashPassword(password);
                    
                    // Determine subscription status based on whether it's a free trial
                    const isFreeTrial = localStorage.getItem('isFreeTrial') === 'true';
                    const subscriptionStatus = isFreeTrial ? 'free_trial' : 'pending';
                    
                    // Create new user with name field and password
                    const { data: newUser, error: createError } = await window.StartupStack.supabase
                        .from('users')
                        .insert([{
                            email: email,
                            name: userName,
                            password_hash: passwordHash,
                            created_at: new Date().toISOString(),
                            updated_at: new Date().toISOString(),
                            subscription_status: subscriptionStatus,
                            plan_type: isFreeTrial ? 'starter' : 'basic',
                            last_login: new Date().toISOString()
                        }])
                        .select()
                        .single();
                        
                    if (createError) {
                        console.error('User creation error:', createError);
                        if (createError.code === '23505') {
                            window.switchTab('login');
                            showNotification('Email already exists. Please log in instead.', 'info');
                            return;
                        }
                        throw new Error('Failed to create account. Please try again.');
                    }
                    
                    // Store user data in localStorage
                    localStorage.setItem('userId', newUser.id);
                    localStorage.setItem('userEmail', email);
                    localStorage.setItem('userName', userName);
                      
                    // Temporarily override showNotification to prevent any success messages during signup
                    window.originalShowNotification = window.showNotification;
                    window.showNotification = function(message, type) {
                        // Only show non-success notifications during signup flow
                        if (type !== 'success' || (!message.toLowerCase().includes('account') && !message.toLowerCase().includes('created'))) {
                            window.originalShowNotification(message, type);
                        }
                    };
                      
                    // Handle free trial vs paid signup
                    if (isFreeTrial) {
                        // Free trial - redirect directly to dashboard
                        closeAuthModal();
                        localStorage.removeItem('isFreeTrial'); // Clean up
                        
                        // Send welcome email for free trial users
                        try {
                            const emailResponse = await fetch('/.netlify/functions/send-welcome-email', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({
                                    email: email,
                                    userName: userName
                                })
                            });

                            if (emailResponse.ok) {
                                console.log('Welcome email sent successfully to:', email);
                            } else {
                                console.error('Welcome email failed:', emailResponse.status);
                            }
                        } catch (emailError) {
                            console.error('Error sending welcome email:', emailError);
                            // Don't fail the signup process if email fails
                        }
                        
                        showNotification('Welcome! Your free trial has started.', 'success');
                        
                        // Small delay for UX, then redirect to dashboard
                        setTimeout(() => {
                            window.location.href = '/dashboard.html';
                        }, 1500);
                    } else {
                        // Paid plan signup - continue with checkout
                        try {
                            // Ensure we have a variant ID set
                            const currentVariantId = localStorage.getItem('selectedVariantId');
                            if (!currentVariantId) {
                                localStorage.setItem('selectedVariantId', '880114'); // Default to Pro plan
                            }
                            
                            // Add small delay to ensure user is created in database
                            await new Promise(resolve => setTimeout(resolve, 1000));
                            
                            // Use inline checkout function that was working
                            const variantId = localStorage.getItem('selectedVariantId') || '880114';
                            
                            const response = await fetch('/.netlify/functions/create-lemonsqueezy-checkout', {
                                method: 'POST',
                                headers: { 
                                    'Content-Type': 'application/json',
                                    'Accept': 'application/json'
                                },
                                body: JSON.stringify({ 
                                    customerEmail: email, 
                                    userId: newUser.id,
                                    variantId: variantId
                                })
                            });
                            
                            if (!response.ok) {
                                const errorText = await response.text();
                                throw new Error(`HTTP ${response.status}: ${errorText}`);
                            }
                            
                            const checkoutData = await response.json();
                            
                            if (!checkoutData || !checkoutData.checkout_url) {
                                throw new Error('Invalid checkout response received');
                            }
                            
                            // Redirect to checkout
                            window.location.href = checkoutData.checkout_url;
                        } catch (checkoutError) {
                            // Restore original notification function
                            if (window.originalShowNotification) {
                                window.showNotification = window.originalShowNotification;
                                window.originalShowNotification = null;
                            }
                            console.error('Checkout error:', checkoutError);
                            throw new Error('Failed to start checkout process. Please try again.');
                        }
                    }
                }
            } catch (error) {
                console.error('Auth error:', error);
                // Restore original notification function if it was overridden
                if (window.originalShowNotification) {
                    window.showNotification = window.originalShowNotification;
                    window.originalShowNotification = null;
                }
                
                showNotification(error.message || 'Authentication failed', 'error');
            } finally {
                submitButton.disabled = false;
                submitButton.innerHTML = isLoginMode ? 'Log In' : 'Create Account';
            }
        });
    });
    </script>

    <footer class="bg-gray-900 py-6 mt-16">
        <div class="container mx-auto px-4 text-center text-gray-400 text-sm">
            <p>&copy; 2025 StartupStack-AI. All rights reserved.</p>
            <div class="mt-2">
                <a href="terms.html" class="hover:text-white mx-2">Terms of Service</a>
                <a href="privacy.html" class="hover:text-white mx-2">Privacy Policy</a>
            </div>
        </div>
    </footer>
</body>
</html>